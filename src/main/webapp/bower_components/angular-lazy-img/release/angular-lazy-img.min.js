angular.module("angularLazyImg",[]),angular.module("angularLazyImg").factory("LazyImgMagic",["$window","lazyImgConfig","lazyImgHelpers",function(n,t,e){"use strict";function o(){for(var n=0,t=m.length;t>n;n++){var o=m[n];o&&e.isElementInView(o.$elem[0],d.offset,g)&&(a(o),u(o),n--)}0===m.length&&s()}function i(n){I.forEach(function(t){t[n]("scroll",p),t[n]("touchmove",p)}),f[n]("resize",p),f[n]("resize",y)}function r(){h=!0,setTimeout(function(){o(),i("on")},1)}function s(){h=!1,i("off")}function u(n){var t=m.indexOf(n);-1!==t&&m.splice(t,1)}function a(n){var t=new Image;t.onerror=function(){d.errorClass&&n.$elem.addClass(d.errorClass),d.onError(n)},t.onload=function(){c(n.$elem,n.src),d.successClass&&n.$elem.addClass(d.successClass),d.onSuccess(n)},t.src=n.src}function c(n,t){"img"===n[0].nodeName.toLowerCase()?n[0].src=t:n.css("background-image",'url("'+t+'")')}function l(n){this.$elem=n}var g,f,m,h,d,p,y,I;return m=[],h=!1,d=t.getOptions(),f=angular.element(n),g=e.getWinDimensions(),y=e.throttle(function(){g=e.getWinDimensions()},60),I=[d.container||f],p=e.throttle(o,30),l.prototype.setSource=function(n){this.src=n,m.push(this),h||r()},l.prototype.removeImage=function(){u(this),0===m.length&&s()},l.prototype.checkImages=function(){o()},l.addContainer=function(n){s(),I.push(n),r()},l.removeContainer=function(n){s(),I.splice(I.indexOf(n),1),r()},l}]),angular.module("angularLazyImg").provider("lazyImgConfig",function(){"use strict";this.options={offset:100,errorClass:null,successClass:null,onError:function(){},onSuccess:function(){}},this.$get=function(){var n=this.options;return{getOptions:function(){return n}}},this.setOptions=function(n){angular.extend(this.options,n)}}),angular.module("angularLazyImg").factory("lazyImgHelpers",["$window",function(n){"use strict";function t(){return{height:n.innerHeight,width:n.innerWidth}}function e(n,t,e){var o=n.getBoundingClientRect(),i=e.height+t;return o.left>=0&&o.right<=e.width+t&&(o.top>=0&&o.top<=i||o.bottom<=i&&o.bottom>=0-t)}function o(n,t,e){var o,i;return function(){var r=e||this,s=+new Date,u=arguments;o&&o+t>s?(clearTimeout(i),i=setTimeout(function(){o=s,n.apply(r,u)},t)):(o=s,n.apply(r,u))}}return{isElementInView:e,getWinDimensions:t,throttle:o}}]),angular.module("angularLazyImg").directive("lazyImg",["$rootScope","LazyImgMagic",function(n,t){"use strict";function e(e,o,i){var r=new t(o);i.$observe("lazyImg",function(n){n&&r.setSource(n)}),e.$on("$destroy",function(){r.removeImage()}),n.$on("lazyImg.runCheck",function(){r.checkImages()})}return{link:e,restrict:"A"}}]).directive("lazyImgContainer",["LazyImgMagic",function(n){"use strict";function t(t,e){n.addContainer(e),t.$on("$destroy",function(){n.removeContainer(e)})}return{link:t,restrict:"A"}}]);